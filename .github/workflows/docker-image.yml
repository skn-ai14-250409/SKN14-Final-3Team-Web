name: Django CICD App

on:
  push:
    branches:
      - main

jobs:
  # jobname
  build-deploy:
    # ìˆ˜í–‰ ì¡°ê±´
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@v2

      - name: Login to Docker hub
        uses: docker/login-action@v1
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Docker build and push
        uses: docker/build-push-action@v2
        with:
          context: .
          file: ./Dockerfile
          push: true
          tags: ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:latest

      - name: Beanstalk Deploy
        uses: einaregilsson/beanstalk-deploy@v20
        with:
          aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
          environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
          region: ap-northeast-2
          version_label: "app-${{ github.sha }}-${{ github.run_number }}"
          deployment_package: Dockerrun.aws.json
          use_existing_version_if_available: true



# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest
#     steps:
#       - name: âœ… 1. Checkout Source Code
#         uses: actions/checkout@v4

#       - name: âœ… 2. Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKERHUB_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}

#       - name: âœ… 3. Build and Push Docker Image
#         uses: docker/build-push-action@v5
#         with:
#           context: .
#           file: ./Dockerfile
#           push: true
#           tags: ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.sha }}

#       - name: âœ… 4. Update Dockerrun.aws.json
#         run: |
#           sed -i 's|"Image": "[^"]*"|"Image": "${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.sha }}"|g' Dockerrun.aws.json

#       - name: ğŸš€ 5. Deploy to Elastic Beanstalk!
#         uses: einaregilsson/beanstalk-deploy@v22
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           version_label: app-${{ github.sha }}
#           deployment_package: Dockerrun.aws.json
#           use_existing_version_if_available: false


# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest
#     steps:
#       # 1. í‘¸ì‹œëœ ìµœì‹  ì½”ë“œë¥¼ ì²´í¬ì•„ì›ƒ
#       - name: Checkout source code
#         uses: actions/checkout@v4

#       # 2. Docker Hub ë¡œê·¸ì¸
#       - name: Docker build and push
#         uses: docker/build-push-action@v2
#         with:
#           context: .
#           file: ./Dockerfile
#           push: true
#           tags: ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:latest

#       - name: Beanstalk Deploy
#         uses: einaregilsson/beanstalk-deploy@v20
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           version_label: "app-${{ github.sha }}"
#           deployment_package: Dockerrun.aws.json
#           use_existing_version_if_available: false




# jobs:
#   build-and-deploy:
#     if: github.event.pull_request.merged == true
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout merged code
#         uses: actions/checkout@v4
#         with:
#           ref: ${{ github.event.pull_request.merge_commit_sha }}

#       - name: Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKERHUB_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}

#       - name: Build and push Docker image
#         uses: docker/build-push-action@v5
#         with:
#           context: .
#           file: ./Dockerfile
#           push: true
#           tags: ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.event.pull_request.merge_commit_sha }}

#       - name: Update Dockerrun.aws.json
#         run: |
#           sed -i 's|"Image": "[^"]*"|"Image": "${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.event.pull_request.merge_commit_sha }}"|g' Dockerrun.aws.json

#       - name: Deploy to Elastic Beanstalk
#         uses: einaregilsson/beanstalk-deploy@v22
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           # â˜…â˜…â˜…â˜…â˜… ì ˆëŒ€ë¡œ ê²¹ì¹˜ì§€ ì•ŠëŠ” ìƒˆ ë²„ì „ ë ˆì´ë¸” ìƒì„± â˜…â˜…â˜…â˜…â˜…
#           version_label: app-${{ github.event.pull_request.merge_commit_sha }}
#           deployment_package: Dockerrun.aws.json
#           # â˜…â˜…â˜…â˜…â˜… ì´ ì˜µì…˜ì„ falseë¡œ ë°”ê¿”ì„œ ì˜›ë‚  ë²„ì „ì„ ì¬ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ê°•ì œ â˜…â˜…â˜…â˜…â˜…
#           use_existing_version_if_available: false



# jobs:
#   build-and-deploy:
#     # PRì´ ë¨¸ì§€(merged)ëœ ê²½ìš°ì—ë§Œ jobì„ ì‹¤í–‰
#     if: github.event.pull_request.merged == true
#     runs-on: ubuntu-latest
#     steps:
#       # 1. ë¨¸ì§€ëœ ìµœì¢… ì½”ë“œë¥¼ ì²´í¬ì•„ì›ƒ
#       - name: Checkout merged code
#         uses: actions/checkout@v4
#         with:
#           ref: ${{ github.event.pull_request.merge_commit_sha }}

#       # 2. Docker Hub ë¡œê·¸ì¸
#       - name: Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKERHUB_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}

#       # 3. Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ (ê³ ìœ í•œ íƒœê·¸ ì‚¬ìš©)
#       - name: Build and push Docker image
#         uses: docker/build-push-action@v5
#         with:
#           context: .
#           file: ./Dockerfile
#           push: true
#           tags: ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.event.pull_request.merge_commit_sha }}

#       # 4. Dockerrun.aws.json íŒŒì¼ì— ë°©ê¸ˆ í‘¸ì‹œí•œ ì´ë¯¸ì§€ íƒœê·¸ ë°˜ì˜
#       - name: Update Dockerrun.aws.json with new image tag
#         run: |
#           echo "Updating Dockerrun.aws.json"
#           sed -i 's|"Image": "[^"]*"|"Image": "${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.event.pull_request.merge_commit_sha }}"|g' Dockerrun.aws.json
#           echo "Dockerrun.aws.json content:"
#           cat Dockerrun.aws.json

#       # 5. Elastic Beanstalkì— ë°°í¬
#       - name: Deploy to Elastic Beanstalk
#         uses: einaregilsson/beanstalk-deploy@v22
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           # â˜…â˜…â˜…â˜…â˜… GitHub Secretsì—ì„œ ì˜¬ë°”ë¥¸ ê°’ìœ¼ë¡œ ìˆ˜ì •í–ˆëŠ”ì§€ í™•ì¸!
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           # â˜…â˜…â˜…â˜…â˜… ì ˆëŒ€ë¡œ ê²¹ì¹˜ì§€ ì•ŠëŠ” ê³ ìœ í•œ ë²„ì „ ë ˆì´ë¸”
#           version_label: app-${{ github.event.pull_request.merge_commit_sha }}
#           deployment_package: Dockerrun.aws.json
#           use_existing_version_if_available: false

# jobs:
#   # jobname
#   build-deploy:
#     # ìˆ˜í–‰ ì¡°ê±´
#     if: github.event.pull_request.merged == true
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout source code
#         uses: actions/checkout@v2

#       - name: Login to Docker hub
#         uses: docker/login-action@v1
#         with:
#           username: ${{ secrets.DOCKERHUB_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}

#       - name: Docker build and push
#         uses: docker/build-push-action@v2
#         with:
#           context: .
#           file: ./Dockerfile
#           push: true
#           tags: ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:latest

#       - name: Beanstalk Deploy
#         uses: einaregilsson/beanstalk-deploy@v20
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           version_label: app-${{ github.sha }}-${{ github.run_number }}-${{ github.run_attempt }}
#           deployment_package: Dockerrun.aws.json
#           use_existing_version_if_available: true


#       - name: Set version label
#         run: echo "VER=app-${GITHUB_SHA}-${GITHUB_RUN_ID}" >> $GITHUB_ENV

#       - name: Make unique Dockerrun
#         run: cp Dockerrun.aws.json Dockerrun-${{ env.VER }}.aws.json

#       - name: Beanstalk Deploy
#         uses: einaregilsson/beanstalk-deploy@v22
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           version_label: ${{ env.VER }}                     # ë¼ë²¨ë„ ìœ ë‹ˆí¬
#           deployment_package: Dockerrun-${{ env.VER }}.aws.json  # íŒŒì¼ëª…ë„ ìœ ë‹ˆí¬
#           use_existing_version_if_available: true

# # jobs:
#   build-deploy:
#     runs-on: ubuntu-latest

#     steps:
#       # 1) ì†ŒìŠ¤ ì²´í¬ì•„ì›ƒ
#       - name: Checkout
#         uses: actions/checkout@v4

#       # 2) Docker Hub ë¡œê·¸ì¸
#       - name: Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKERHUB_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}

#       # 3) ì´ë¯¸ì§€ ë¹Œë“œ/í‘¸ì‹œ (latest + ë¶ˆë³€íƒœê·¸ SHA)
#       - name: Build & push
#         uses: docker/build-push-action@v5
#         with:
#           context: .
#           file: ./Dockerfile
#           push: true
#           tags: |
#             ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.sha }}
#             ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:latest

#       # 4) Dockerrunì—ì„œ :latestë¥¼ SHAë¡œ ê³ ì •(ê¶Œì¥)
#       - name: Pin image tag in Dockerrun
#         run: |
#           sed -i "s#:latest#:${GITHUB_SHA}#g" Dockerrun.aws.json

#       # 5) EB ì†ŒìŠ¤ ë²ˆë“¤(zip) ìƒì„±: **ZIP ë£¨íŠ¸ì— Dockerrunë§Œ** ìˆê²Œ ë§Œë“¤ê¸°
#       - name: Create EB bundle (.zip)
#         run: |
#           mkdir -p bundle
#           cp Dockerrun.aws.json bundle/
#           cd bundle
#           # zip ë£¨íŠ¸ì— ë°”ë¡œ Dockerrunì´ ì˜¤ë„ë¡ ìƒìœ„ ê²½ë¡œë¡œ zip ìƒì„±
#           zip -r ../deploy-${{ github.sha }}.zip .
#           cd ..
#           # ë””ë²„ê·¸: zip ë‚´ìš© í™•ì¸ (ë£¨íŠ¸ì— íŒŒì¼ í•˜ë‚˜ë§Œ ìˆì–´ì•¼ ì •ì„)
#           unzip -l deploy-${{ github.sha }}.zip

#       # 6) EB ë°°í¬ â€” zip íŒŒì¼ì„ **deployment_package**ë¡œ ë„˜ê¸´ë‹¤
#       - name: Beanstalk Deploy
#         uses: einaregilsson/beanstalk-deploy@v22
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           version_label: app-${{ github.sha }}-${{ github.run_attempt }}  # ì¬ì‹œë„ì—ë„ ìœ ë‹ˆí¬
#           deployment_package: deploy-${{ github.sha }}.zip                # â† **ë°˜ë“œì‹œ ZIP ê²½ë¡œ**
#           use_existing_version_if_available: true



# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest
#     steps:
#       - name: âœ… 1. Checkout Source Code
#         uses: actions/checkout@v4

#       - name: âœ… 2. Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKERHUB_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}

#       - name: âœ… 3. Build and Push Docker Image
#         uses: docker/build-push-action@v5
#         with:
#           context: .
#           file: ./Dockerfile
#           push: true
#           tags: ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.sha }}

#       - name: âœ… 4. Update Dockerrun.aws.json
#         run: |
#           sed -i 's|"Image": "[^"]*"|"Image": "${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.sha }}"|g' Dockerrun.aws.json

#       - name: ğŸš€ 5. Deploy to Elastic Beanstalk!
#         uses: einaregilsson/beanstalk-deploy@v22
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           version_label: app-${{ github.sha }}
#           deployment_package: Dockerrun.aws.json
#           use_existing_version_if_available: false


# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest
#     steps:
#       # 1. í‘¸ì‹œëœ ìµœì‹  ì½”ë“œë¥¼ ì²´í¬ì•„ì›ƒ
#       - name: Checkout source code
#         uses: actions/checkout@v4

#       # 2. Docker Hub ë¡œê·¸ì¸
#       - name: Docker build and push
#         uses: docker/build-push-action@v2
#         with:
#           context: .
#           file: ./Dockerfile
#           push: true
#           tags: ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:latest

#       - name: Beanstalk Deploy
#         uses: einaregilsson/beanstalk-deploy@v20
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           version_label: "app-${{ github.sha }}"
#           deployment_package: Dockerrun.aws.json
#           use_existing_version_if_available: false




# jobs:
#   build-and-deploy:
#     if: github.event.pull_request.merged == true
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout merged code
#         uses: actions/checkout@v4
#         with:
#           ref: ${{ github.event.pull_request.merge_commit_sha }}

#       - name: Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKERHUB_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}

#       - name: Build and push Docker image
#         uses: docker/build-push-action@v5
#         with:
#           context: .
#           file: ./Dockerfile
#           push: true
#           tags: ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.event.pull_request.merge_commit_sha }}

#       - name: Update Dockerrun.aws.json
#         run: |
#           sed -i 's|"Image": "[^"]*"|"Image": "${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.event.pull_request.merge_commit_sha }}"|g' Dockerrun.aws.json

#       - name: Deploy to Elastic Beanstalk
#         uses: einaregilsson/beanstalk-deploy@v22
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           # â˜…â˜…â˜…â˜…â˜… ì ˆëŒ€ë¡œ ê²¹ì¹˜ì§€ ì•ŠëŠ” ìƒˆ ë²„ì „ ë ˆì´ë¸” ìƒì„± â˜…â˜…â˜…â˜…â˜…
#           version_label: app-${{ github.event.pull_request.merge_commit_sha }}
#           deployment_package: Dockerrun.aws.json
#           # â˜…â˜…â˜…â˜…â˜… ì´ ì˜µì…˜ì„ falseë¡œ ë°”ê¿”ì„œ ì˜›ë‚  ë²„ì „ì„ ì¬ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ê°•ì œ â˜…â˜…â˜…â˜…â˜…
#           use_existing_version_if_available: false



# jobs:
#   build-and-deploy:
#     # PRì´ ë¨¸ì§€(merged)ëœ ê²½ìš°ì—ë§Œ jobì„ ì‹¤í–‰
#     if: github.event.pull_request.merged == true
#     runs-on: ubuntu-latest
#     steps:
#       # 1. ë¨¸ì§€ëœ ìµœì¢… ì½”ë“œë¥¼ ì²´í¬ì•„ì›ƒ
#       - name: Checkout merged code
#         uses: actions/checkout@v4
#         with:
#           ref: ${{ github.event.pull_request.merge_commit_sha }}

#       # 2. Docker Hub ë¡œê·¸ì¸
#       - name: Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKERHUB_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}

#       # 3. Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ (ê³ ìœ í•œ íƒœê·¸ ì‚¬ìš©)
#       - name: Build and push Docker image
#         uses: docker/build-push-action@v5
#         with:
#           context: .
#           file: ./Dockerfile
#           push: true
#           tags: ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.event.pull_request.merge_commit_sha }}

#       # 4. Dockerrun.aws.json íŒŒì¼ì— ë°©ê¸ˆ í‘¸ì‹œí•œ ì´ë¯¸ì§€ íƒœê·¸ ë°˜ì˜
#       - name: Update Dockerrun.aws.json with new image tag
#         run: |
#           echo "Updating Dockerrun.aws.json"
#           sed -i 's|"Image": "[^"]*"|"Image": "${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.event.pull_request.merge_commit_sha }}"|g' Dockerrun.aws.json
#           echo "Dockerrun.aws.json content:"
#           cat Dockerrun.aws.json

#       # 5. Elastic Beanstalkì— ë°°í¬
#       - name: Deploy to Elastic Beanstalk
#         uses: einaregilsson/beanstalk-deploy@v22
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           # â˜…â˜…â˜…â˜…â˜… GitHub Secretsì—ì„œ ì˜¬ë°”ë¥¸ ê°’ìœ¼ë¡œ ìˆ˜ì •í–ˆëŠ”ì§€ í™•ì¸!
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           # â˜…â˜…â˜…â˜…â˜… ì ˆëŒ€ë¡œ ê²¹ì¹˜ì§€ ì•ŠëŠ” ê³ ìœ í•œ ë²„ì „ ë ˆì´ë¸”
#           version_label: app-${{ github.event.pull_request.merge_commit_sha }}
#           deployment_package: Dockerrun.aws.json
#           use_existing_version_if_available: false

# jobs:
#   # jobname
#   build-deploy:
#     # ìˆ˜í–‰ ì¡°ê±´
#     if: github.event.pull_request.merged == true
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout source code
#         uses: actions/checkout@v2

#       - name: Login to Docker hub
#         uses: docker/login-action@v1
#         with:
#           username: ${{ secrets.DOCKERHUB_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}

#       - name: Docker build and push
#         uses: docker/build-push-action@v2
#         with:
#           context: .
#           file: ./Dockerfile
#           push: true
#           tags: ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:latest

#       - name: Beanstalk Deploy
#         uses: einaregilsson/beanstalk-deploy@v20
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           version_label: app-${{ github.sha }}-${{ github.run_number }}-${{ github.run_attempt }}
#           deployment_package: Dockerrun.aws.json
#           use_existing_version_if_available: true


#       - name: Set version label
#         run: echo "VER=app-${GITHUB_SHA}-${GITHUB_RUN_ID}" >> $GITHUB_ENV

#       - name: Make unique Dockerrun
#         run: cp Dockerrun.aws.json Dockerrun-${{ env.VER }}.aws.json

#       - name: Beanstalk Deploy
#         uses: einaregilsson/beanstalk-deploy@v22
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           version_label: ${{ env.VER }}                     # ë¼ë²¨ë„ ìœ ë‹ˆí¬
#           deployment_package: Dockerrun-${{ env.VER }}.aws.json  # íŒŒì¼ëª…ë„ ìœ ë‹ˆí¬
#           use_existing_version_if_available: true

# # jobs:
#   build-deploy:
#     runs-on: ubuntu-latest

#     steps:
#       # 1) ì†ŒìŠ¤ ì²´í¬ì•„ì›ƒ
#       - name: Checkout
#         uses: actions/checkout@v4

#       # 2) Docker Hub ë¡œê·¸ì¸
#       - name: Login to Docker Hub
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKERHUB_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}

#       # 3) ì´ë¯¸ì§€ ë¹Œë“œ/í‘¸ì‹œ (latest + ë¶ˆë³€íƒœê·¸ SHA)
#       - name: Build & push
#         uses: docker/build-push-action@v5
#         with:
#           context: .
#           file: ./Dockerfile
#           push: true
#           tags: |
#             ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:${{ github.sha }}
#             ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.DOCKER_IMAGENAME }}:latest

#       # 4) Dockerrunì—ì„œ :latestë¥¼ SHAë¡œ ê³ ì •(ê¶Œì¥)
#       - name: Pin image tag in Dockerrun
#         run: |
#           sed -i "s#:latest#:${GITHUB_SHA}#g" Dockerrun.aws.json

#       # 5) EB ì†ŒìŠ¤ ë²ˆë“¤(zip) ìƒì„±: **ZIP ë£¨íŠ¸ì— Dockerrunë§Œ** ìˆê²Œ ë§Œë“¤ê¸°
#       - name: Create EB bundle (.zip)
#         run: |
#           mkdir -p bundle
#           cp Dockerrun.aws.json bundle/
#           cd bundle
#           # zip ë£¨íŠ¸ì— ë°”ë¡œ Dockerrunì´ ì˜¤ë„ë¡ ìƒìœ„ ê²½ë¡œë¡œ zip ìƒì„±
#           zip -r ../deploy-${{ github.sha }}.zip .
#           cd ..
#           # ë””ë²„ê·¸: zip ë‚´ìš© í™•ì¸ (ë£¨íŠ¸ì— íŒŒì¼ í•˜ë‚˜ë§Œ ìˆì–´ì•¼ ì •ì„)
#           unzip -l deploy-${{ github.sha }}.zip

#       # 6) EB ë°°í¬ â€” zip íŒŒì¼ì„ **deployment_package**ë¡œ ë„˜ê¸´ë‹¤
#       - name: Beanstalk Deploy
#         uses: einaregilsson/beanstalk-deploy@v22
#         with:
#           aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
#           aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#           application_name: ${{ secrets.AWS_EB_APPLICATION_NAME }}
#           environment_name: ${{ secrets.AWS_EB_ENVIRONMENT_NAME }}
#           region: ap-northeast-2
#           version_label: app-${{ github.sha }}-${{ github.run_attempt }}  # ì¬ì‹œë„ì—ë„ ìœ ë‹ˆí¬
#           deployment_package: deploy-${{ github.sha }}.zip                # â† **ë°˜ë“œì‹œ ZIP ê²½ë¡œ**
#           use_existing_version_if_available: true